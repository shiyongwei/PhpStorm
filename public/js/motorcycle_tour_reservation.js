ER.NumberSelector=function(e){var t=null,n=function(e){t=e,t.find(".js-numberCheckbox").on("ifClicked",a),t.find(".js-numberField").focus(function(){t.find('.js-numberCheckbox[value=""]').iCheck("check")}),t.find(".js-numberCheckbox:checked").trigger("ifClicked")},a=function(){var e=$(this);""==e.val()?(t.find(".js-label").hide(),t.find(".js-numberField").show().focus()):(t.find(".js-label").show(),t.find(".js-numberField").hide().blur().val(""))},s=function(){var e=t.find(".js-numberCheckbox");e.filter(":not(:checked)").attr("disabled",!0),""!=e.filter(":checked").val()&&t.find(".js-numberField").attr("disabled",!0)};this.disableUnusedFields=s,n(e)},ER.require("ER.Reservation.Calendar",{}),ER.Reservation.Calendar=function(e){var t=function(e,t,n){this.startDate=new Date(ER.DatesUtility.parseDateString(e,["00","00","00"])),this.endDate=new Date(ER.DatesUtility.parseDateString(t,["23","59","59"])),this.startOffset=0,this.endOffset=0,this.reason=n,this.isDateIncluded=function(e){var t=new Date(this.startDate);t.setDate(t.getDate()+this.startOffset);var n=new Date(this.endDate);return n.setDate(n.getDate()-this.endOffset),e>=t&&n>=e?!0:!1},this.setStartOffset=function(e){this.startOffset=e},this.setEndOffset=function(e){this.endOffset=e}},n=function(e,t){this.startDate=new Date(ER.DatesUtility.parseDateString(e,["00","00","00"])),this.endDate=new Date(ER.DatesUtility.parseDateString(t,["23","59","59"])),this.startOffset=0,this.endOffset=0,this.isDateOutOfRange=function(e){var t=new Date(this.startDate);t.setDate(t.getDate()+this.startOffset);var n=new Date(this.endDate);return n.setDate(n.getDate()-this.endOffset),e>=t&&n>=e?!1:!0},this.setStartOffset=function(e){this.startOffset=e},this.setEndOffset=function(e){this.endOffset=e}},a=null,s=null,i=null,o=null,c=[],r=function(e){d(e)},d=function(e){a=e.minDate,e.maxDate&&(s=new Date(Date.parse(e.maxDate))),i=e.weekDays,o=[],e.blackoutIntervals&&$(e.blackoutIntervals).each(function(){o.push(new t(this.start,this.end,this.reason))}),e.availabilityIntervals&&$(e.availabilityIntervals).each(function(){c.push(new n(this.start,this.end))})},f=function(e){var t=!1;if(i){var n=!1;$.each(i,function(t,a){t=t.slice(1,-1);var s=t.indexOf(",",t.indexOf(",")+1),i=new Date(t.slice(0,s)+" 00:00:00"),o=new Date(t.slice(s+2)+" 00:00:00");e>=i&&o>=e&&$(a).each(function(){this.day==e.getDay()&&(n=!0)})}),t=!n,1==t&&(closeReason="Out of working days")}if(0==t&&($(o).each(function(){this.isDateIncluded(e)&&(t=!0,closeReason=this.reason)}),c.length>0)){var a=!1;0==t&&$(c).each(function(){this.isDateOutOfRange(e)||(a=!0)}),a||(t=!0,closeReason="Out of availability range")}return t?[!1,"",closeReason]:[!0,""]};this.checkDayAvailability=f,this.getMinDate=function(){return new Date(a)},this.getMaxDate=function(){return s},this.setMaxDate=function(e){s=e},this.getBlackoutIntervals=function(){return o},this.getAvailabilityIntervals=function(){return c},this.getWeekDays=function(){return i},r(e)},ER.require("ER.Pickadate.Handler",function(){var e={},t=function(e,t){var n=t.getAvailabilityIntervals(),a=t.getBlackoutIntervals(),s=t.getWeekDays(),i=t.getMinDate(),o=t.getMaxDate();n.length>0&&(e.set("disable",[{from:i,to:o}]),$(n).each(function(){e.set("enable",[{from:this.startDate,to:this.endDate}])})),$(a).each(function(){e.set("disable",[{from:this.startDate,to:this.endDate}])}),s&&$.each(s,function(t,n){t=t.slice(1,-1);for(var a=t.indexOf(",",t.indexOf(",")+1),s=new Date(t.slice(0,a)+" 00:00:00"),i=new Date(t.slice(a+2)+" 00:00:00"),o=$.map(n,function(e){return e.day}),c=[],r=s;i>=r;r.setDate(r.getDate()+1))-1==o.indexOf(r.getDay())&&c.push(new Date(r));e.set("disable",c)})};return e.configure=t,e}()),ER.require("ER.MotorcycleTourReservation",function(){var e={},t=null,n=null,a=null,s=null,i=null,o=2,c=function(e){r(e),n=$(".js-motorcycleTourReservation"),f()};e.init=c;var r=function(e){e=e||{},i=e.calendarOptions,e.numberOfMonths&&(o=e.numberOfMonths),e.toursWidget&&(t=e.toursWidget)},d=function(){ER.Layout.mobileView||a.disableUnusedFields();var e=s.serialize(!0);s.find(".js-segment-check:checked").each(function(){"disabled"==$(this).attr("disabled")&&(e+=encodeURI("&motorcycle_tour_reservation[segment_ids][]="+$(this).val()))}),$.ajax({url:ER.Layout.jsUrl(s.attr("action")),type:"get",dataType:"json",data:e,success:function(e){n.html(e.form_html),f()},error:function(e){var t=JSON.parse(e.responseText);ER.Notifications.showErrorMessage(t.message)}})};e.onChange=d;var f=function(){t&&h(),s=n.find("form");var e=s.find(".js-occurrencesSelect");ER.Layout.mobileView?($(".ui.dropdown").dropdown(),s.find(".js-packagesBtn").click(function(){var e=$(this).attr("data-type"),t=$(".js-packagesCount"),n=parseInt(t.val());"minus"==e&&n>1?t.val(n-1):"plus"==e&&t.val(n+1)})):(ER.Layout.initCheckboxes(s),a=new ER.NumberSelector($(".js-numberSelection"))),e.change(d),n.find(".js-bookTrigger").click(function(){ER.Layout.mobileView||a.disableUnusedFields(),s.find(".js-hasPromotionCode").is(":checked")||s.find(".js-promotionCode").attr("disabled",!0);var e=s.serialize(!0);return s.find(".js-segment-check:checked").each(function(){"disabled"==$(this).attr("disabled")&&(e+=encodeURI("&motorcycle_tour_reservation[segment_ids][]="+$(this).val()))}),ER.Layout.showSpinner(),$.ajax({url:ER.Layout.jsUrl(s.attr("action")),type:s.attr("method"),dataType:"json",data:e,success:function(e){window.location.href=e.redirection_url},error:function(e){var t=JSON.parse(e.responseText);406==e.status?(t.base_errors.length>0&&ER.Notifications.showErrorMessage(t.base_errors.join(" & ")),n.html(t.form_html),f()):ER.Notifications.showErrorMessage(t.message),ER.Layout.hideSpinner()}}),!1});var c=s.find(".js-pickupDate");if(c.length>0){var r=new ER.Reservation.Calendar(i);if(ER.Layout.mobileView){var u=c.pickadate({min:r.getMinDate(),format:ER.Layout.widgetDateFormat().replace("yy","yyyy"),selectMonths:!0,selectYears:2,onSet:function(e){"select"in e&&(d(),this.close())}}),g=u.pickadate("picker");ER.Pickadate.Handler.configure(g,r)}else c.datepicker({minDate:r.getMinDate(),onSelect:d,beforeShowDay:function(e){return r.checkDayAvailability(e)},numberOfMonths:o,dateFormat:"mm/dd/yy"}),c.datepicker("option","dateFormat",ER.Layout.widgetDateFormat()),c.next(".js-calendarIcon").click(function(){c.datepicker("show")})}s.find(".js-hasPromotionCode").bind("ifChecked",function(){s.find(".js-promotionCode").show()}),s.find(".js-hasPromotionCode").bind("ifUnchecked",function(){s.find(".js-promotionCode").hide()}),ER.Layout.mobileView?s.find(".js-segment-check").on("change",function(){m($(this))}):s.find(".js-segment-check").on("ifToggled",function(){m($(this))}),$(".js-segments").length>0&&l(s.find(".js-segment-check:checked:last").parents(".js-segment"))},h=function(){var e=t.find(".js-promo");e.hide().css({right:-100,opacity:0}),t.mouseenter($("body").hasClass("de")||$("body").hasClass("ru")||$("body").hasClass("no")||$("body").hasClass("sv")?function(){e.show().animate({right:-320,opacity:1},50)}:$("body").hasClass("da")||$("body").hasClass("nl")?function(){e.show().animate({right:-340,opacity:1},50)}:function(){e.show().animate({right:-200,opacity:1},50)}),t.mouseleave(function(){e.animate({right:-100,opacity:0},200,function(){$(this).hide()})})},l=function(e){s.find(".js-package").hide();var t=s.find(".js-package[data-segmentId="+e.attr("data-id")+"]");t.show();var n=$.map(s.find(".js-segment-check:checked"),function(e){return $(e).val()});t.each(function(){var e=$(this).attr("data-packageOptions"),t=0;s.find(".js-package[data-packageOptions='"+e+"']").each(function(){n.indexOf($(this).attr("data-segmentId"))>-1&&(t+=parseFloat($(this).attr("data-packagePrice")))});var a=$(this).find(".js-priceText");a.text(a.attr("data-priceTemplate").replace("[PRICE]",t))})},u=function(e){if(0==e.find(".js-segment-check:checked").length)g(e.find(".js-segment-check"),!0);else{g(e.find(".js-segment-check"),!1),e.find(".js-segment-check:checked").each(function(){g($(this),!0),g($(this).parents(".js-segment").next(".js-segment").find(".js-segment-check"),!0),g($(this).parents(".js-segment").prev(".js-segment").find(".js-segment-check"),!0)});var t=e.find(".js-segment-check:checked:first"),n=e.find(".js-segment-check:checked:last");g(t,!0),g(n,!0),g(e.find(".js-segment-check:checked").not(t).not(n),!1)}},g=function(e,t){ER.Layout.mobileView?e.prop("disabled",!t):e.iCheck(t?"enable":"disable")},m=function(e){var t=e.parents(".js-segment"),n=t.next(".js-segment"),a=t.prev(".js-segment");t.toggleClass("active-segment"),e.is(":checked")?(n.hasClass("active-segment")&&n.addClass("conected"),a.hasClass("active-segment")&&t.addClass("conected"),l(t)):(n.removeClass("conected"),l(s.find(".js-segment-check:checked:last").parents(".js-segment"))),u(s)};return e}());